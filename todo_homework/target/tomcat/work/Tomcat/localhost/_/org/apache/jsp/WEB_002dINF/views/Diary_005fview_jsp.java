/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2018-06-20 03:42:30 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.views;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.sql.*;
import java.util.*;
import java.text.*;
import java.io.*;
import org.study.Dao.*;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.util.*;

public final class Diary_005fview_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, false, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n");
      out.write("<title>Insert title here</title>\r\n");
      out.write("<style type=\"text/css\">\r\n");
      out.write("\t#diary{\r\n");
      out.write("\t\t/*background-image:url(img/back.jpg);*/\r\n");
      out.write("\t}\r\n");
      out.write("\ttd{\r\n");
      out.write("\t\tfont-family:휴면매직체;\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("</style>\r\n");
      out.write("<script type=\"text/javascript\">\r\n");
      out.write("\tfunction change(){\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tdocument.frm.submit();\r\n");
      out.write("\t}\r\n");
      out.write("</script>\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");
      out.write("\t");

		HttpSession session = request.getSession(true);
		String id = (String)session.getAttribute("id");
		String name=(String)session.getAttribute("name");
		
		
		SimpleDateFormat simpleDate=new SimpleDateFormat("yyyy-MM-dd");
		String today = simpleDate.format(new java.util.Date());
		
		Calendar cal = Calendar.getInstance();
		
		int year = cal.get(Calendar.YEAR);
		int month = cal.get(Calendar.MONTH)+1;
		//int day = cal.get(Calendar.DATE);
		
	
		 String[] strWeek={
			"일","월","화","수","목","금","토"
		};
		 
		 int[] lastDay= {
			31,28,31,30,31,30,
			31,31,30,31,30,31
		};
		
		 
		 String strYear = request.getParameter("year");
		 String strMonth=request.getParameter("month");
			
		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-M");
		StringTokenizer st = new StringTokenizer(sdf.format(new java.util.Date()),"-");
		
		//strYear//와 strMonth가 없을때(null) 현재 달로 넣아줌.
		if(strYear == null)
		{
			strYear=st.nextToken();
		}
		if(strMonth == null)
		{
			strMonth=st.nextToken();
		}
		
		year = Integer.parseInt(strYear);
		month = Integer.parseInt(strMonth);
	
      out.write("\r\n");
      out.write("<center>\t\r\n");
      out.write("\t<h1>");
      out.print(id);
      out.write('님');
      out.write('의');
      out.write(' ');
      out.print(year );
      out.write('년');
      out.write(' ');
      out.print(month );
      out.write("월 일정</h1>\r\n");
      out.write("\t\r\n");
      out.write("\t<table border=\"1\" width=\"560\">\r\n");
      out.write("\t\t<tr>\r\n");
      out.write("\t\t <td align=\"left\">\r\n");
      out.write("\t\t\t<form name=\"frm\" action=\"/DiaryServlet\">\r\n");
      out.write("\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\t<table border=\"0\" width=\"560\">\r\n");
      out.write("\t\t\t\t<tr>\r\n");
      out.write("\t\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t\t<select name=\"year\" onchange=\"change();\"> \r\n");
      out.write("\t\t\t\t\t\t");

							for(int k=2010; k<=2030; k++){
								if(k==year){
						
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t<option selected>");
      out.print(k );
      out.write("</option>\r\n");
      out.write("\t\t\t\t\t\t");

							}else{
						
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t<option>");
      out.print(k );
      out.write("</option>\r\n");
      out.write("\t\t\t\t\t\t");

								}
							}
						 
      out.write("\t\r\n");
      out.write("\t\t\t\t\t\t</select>년도&nbsp;&nbsp;&nbsp;\r\n");
      out.write("\t\t\t\t\t\t<select name=\"month\" onchange=\"change()\">\r\n");
      out.write("\t\t\t\t\t\t");

							for(int i=1;i<=12;i++){
								
								if(i==month){
						
      out.write("\t\r\n");
      out.write("\t\t\t\t\t\t\t<option selected>");
      out.print(i );
      out.write("</option>\r\n");
      out.write("\t\t\t\t\t\t");

								}
								else{
								
						 
      out.write("\r\n");
      out.write("\t\t\t\t\t\t \t<option>");
      out.print(i );
      out.write("</option>\r\n");
      out.write("\t\t\t\t\t\t ");

								}
							}
						 
      out.write("\r\n");
      out.write("\t\t\t\t\t\t</select>월\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\r\n");
      out.write("\t\t\t   \t\t</td>\r\n");
      out.write("\t\t\t\t</tr>\r\n");
      out.write("\t\t\t</table>\r\n");
      out.write("\t\t </form>\r\n");
      out.write("\t\t </td>\r\n");
      out.write("\t\t</tr>\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t\t\t\t<!--요일출력 start  --> \r\n");
      out.write("\t\t\t\t\t\t<tr bgcolor=\"#ccccff\">\r\n");
      out.write("\t\t\t\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t\t\t\t<table border=\"1\" width=\"560\" bordercolor=\"#ccccff\">\r\n");
      out.write("\t\t\t\t\t\t\t\t\t<tr bgcolor=\"#ccccff\" >\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t");

											String color="black";
										
											for(int i=0; i<7; i++){
												
												if(i==0)
													color="red";
												else if(i==6)
													color="blue";
												else
													color="black";				
												
											
										
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t<td align=\"center\" width=\"80\" height=\"40\">\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t<font color=\"");
      out.print(color );
      out.write("\"><b>");
      out.print(strWeek[i] );
      out.write("</b></font>\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t");

											}
										
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t\t\t\t\t</table>\r\n");
      out.write("\t\t\t\t\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t\t\t </tr>\t\r\n");
      out.write("\t\t\t\t\t<!--  요일출력 end -->\r\n");
      out.write("\t\t\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t<!--  달력출력 start-->   \r\n");
      out.write("\t\t\t\t     <tr> \r\n");
      out.write("\t\t\t\t\t     <td>  \r\n");
      out.write("\t\t\t\t\t\t\t\t");

									int total=(year-1)*365 + (year-1)/4 - (year-1)/100 + (year-1)/400; 
							        // --------- year=2018 전년도 2017.12.31일까지 총합을 구함 
							         
							        if((year%4==0 && year%100!=0) || (year%400==0)) 
							        { 
							            lastDay[1]=29; 
							        } 
							        else 
							        { 
							            lastDay[1]=28; 
							        } 
							         
							        for(int i=0; i<month-1; i++) 
							        { 
							            total+=lastDay[i]; 
							        } 
							        //  ------- 전달까지 2018. 5. 31일까지 총합을 구함 
							        total++; 
							        // ------- 2018. 6. 1일까지 총합 
							         
							        int week = total % 7; // 9.1일자의 요일을 구할수 있음 
							     
      out.write(" \r\n");
      out.write("\t\t\t\t\t        <table id=\"diary\" border=\"1\" width=\"560\" bordercolor=\"#ccccff\"> \r\n");
      out.write("\t\t\t\t\t\t\t\t     ");
    
								        for(int i=1; i<=lastDay[month-1]; i++) 
								        { 
								            if(week==0) 
								                color="red"; 
								            else if(week==6) 
								                color="blue"; 
								            else 
								                color="black"; 
								            if(i==1) 
								            { 
								         
      out.write("\r\n");
      out.write("\t\t\t\t\t            <tr> \r\n");
      out.write("\t\t\t\t\t\t\t         ");

							                for(int j=0; j<week; j++) 
							                { 
							            
      out.write("\r\n");
      out.write("\t\t\t\t\t              \r\n");
      out.write("\t\t\t\t\t               <td width=\"80\" height=\"60\" align=\"left\" valign=\"top\">\r\n");
      out.write("\t\t\t\t\t                   &nbsp;\r\n");
      out.write("\t\t\t\t\t               </td>\r\n");
      out.write("\t\t\t\t\t\t\t                   \r\n");
      out.write("\t\t\t\t\t\t\t              ");
 
							                } 
							            } 
							         
      out.write("  \r\n");
      out.write("\t\t\t\t\t\t\t      <td width=\"80\" height=\"60\" align=\"left\" valign=\"top\">\r\n");
      out.write("\t\t\t\t\t\t\t         \t<font color=\"");
      out.print(color );
      out.write("\"><b>\r\n");
      out.write("\t\t\t\t\t\t\t         \t\r\n");
      out.write("\t\t\t\t\t\t\t         \t<!-- 일출력 -->\r\n");
      out.write("\t\t\t\t\t\t\t         \t<!-- get방식으로 year, month, day, id 전송하고 &은 변수구분--> \r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\t\t\t\t\t         \t<a href=\"/InsertServlet?year=");
      out.print(year );
      out.write("&month=");
      out.print(month );
      out.write("&day=");
      out.print(i );
      out.write("&id=");
      out.print(id);
      out.write("\" title=\"일정추가하기\" style=\"text-decoration:none;\">");
      out.print(i );
      out.write("</a></b></font>\r\n");
      out.write("\t\t\t\t\t\t\t         \t<!-- 그림출력위치 -->\r\n");
      out.write("\t\t\t\t\t\t\t\t         \t");

								         		DiaryDAO dao = new DiaryDAO();
								         		boolean bCheck = dao.isDate(id, year, month, i);
								         		System.out.println(bCheck);
								         		int count = dao.isCount(id, year, month, i);
								         		String str="일정:"+count+"개";
								         		
								         		if(bCheck==true)
								         		{
								         			
								         			/*
								         				다른 페잊로 이동(페이지의 흐름)
								         				
								         				HTML
								         				<form action=..>: GET방식과 POST방식 둘다 지원
								         				
								         				GET방식만 지원
								         				<a href="">
								         				JavaScript
								         				location.href="파일"
								         				
								         				Java
								         				response.sendRedirect("사이트");
								         				RequestDispatcher
								         				=>forward("사이트")
								         				
								      
								         			
								         			*/
								         		
								         	
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t\t         \t\r\n");
      out.write("\t\t\t\t\t\t\t\t\t         \t<a href=\"ListServlet?id=");
      out.print(id );
      out.write("&year=");
      out.print(year );
      out.write("&month=");
      out.print(month );
      out.write("&day=");
      out.print(i );
      out.write("\" style=\"font-size:12px;font-weight:bold;text-decoration:none;\" title=\"일정보기\"><br>\r\n");
      out.write("\t\t\t\t\t\t\t\t\t         \t\t<img src=\"/img/pin.jpg\" border=\"0\" alt=\"");
      out.print(str );
      out.write('"');
      out.write('>');
      out.print(str );
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t\t\t         \t</a>\r\n");
      out.write("\t\t\t\t\t\t\t\t\t        \r\n");
      out.write("\t\t\t\t\t\t\t\t         \t");

								         		}
					         				
      out.write("\r\n");
      out.write("\t\t\t\t\t        \t</td>\r\n");
      out.write("\t\t\t\t\t\t         ");

						         	week++;
						         
						         	if(week>6){
						         		week=0;
						         
      out.write("\r\n");
      out.write("\t\t\t\t\t\t         </tr>\r\n");
      out.write("\t\t\t\t\t\t         <tr>\r\n");
      out.write("\t\t\t\t\t\t   ");

					         	}
					        }
					        
      out.write("\r\n");
      out.write("\t\t\t\t\t         </tr>\t\r\n");
      out.write("\t\t\t\t\t\t\t</tr>\r\n");
      out.write("\t\t\t\t\t</table>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t</tr> \r\n");
      out.write("\t\t<!-- 달력출력 end -->\r\n");
      out.write("\t</td>\r\n");
      out.write("  </tr>\t\r\n");
      out.write("\t\t\r\n");
      out.write("</table>\r\n");
      out.write("\r\n");
      out.write("</center>\t\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("</body>\r\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
